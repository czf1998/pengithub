<div id="readme" class="instapaper_body md" data-path="README.md"><article class="markdown-body entry-content p-5" itemprop="text"><h1><a id="user-content-bayard" class="anchor" aria-hidden="true" href="#bayard"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Bayard</h1>↵<p>Bayard is a full-text search and indexing server written in <a href="https://www.rust-lang.org/" rel="nofollow">Rust</a> built on top of <a href="https://github.com/tantivy-search/tantivy">Tantivy</a> that implements <a href="https://raft.github.io/" rel="nofollow">The Raft Consensus Algorithm</a> by <a href="https://github.com/tikv/raft-rs">raft-rs</a> and <a href="https://grpc.io/" rel="nofollow">The gRPC</a> (<a href="https://en.wikipedia.org/wiki/HTTP/2" rel="nofollow">HTTP/2</a> + <a href="https://developers.google.com/protocol-buffers" rel="nofollow">Protocol Buffers</a>) by <a href="https://github.com/tikv/grpc-rs">grpc-rs</a> and <a href="https://github.com/stepancheg/rust-protobuf">rust-protobuf</a>.<br>↵Achieves consensus across all the nodes, ensures every change made to the system is made to a quorum of nodes.<br>↵Bayard makes easy for programmers to develop search applications with advanced features and high availability.</p>↵<h2><a id="user-content-features" class="anchor" aria-hidden="true" href="#features"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Features</h2>↵<ul>↵<li>Full-text search/indexing</li>↵<li>Index replication</li>↵<li>Bringing up a cluster</li>↵<li>Command line interface is available</li>↵</ul>↵<h2><a id="user-content-building-bayard" class="anchor" aria-hidden="true" href="#building-bayard"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Building Bayard</h2>↵<pre lang="text"><code>$ make build↵</code></pre>↵<h2><a id="user-content-starting-in-standalone-mode-single-node-cluster" class="anchor" aria-hidden="true" href="#starting-in-standalone-mode-single-node-cluster"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Starting in standalone mode (single node cluster)</h2>↵<p>Running node in standalone mode is easy. See following command:</p>↵<pre lang="text"><code>$ ./bin/bayard serve↵</code></pre>↵<h3><a id="user-content-indexing-document" class="anchor" aria-hidden="true" href="#indexing-document"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Indexing document</h3>↵<p>Indexing a document is as following:</p>↵<pre lang="text"><code>$ ./bin/bayard set 1 '{"text":"Tantivy is a full-text search engine library inspired by Apache Lucene and written in Rust."}'↵$ ./bin/bayard set 2 '{"text":"Apache Lucene is a high-performance, full-featured text search engine library written entirely in Java."}'↵$ ./bin/bayard set 3 '{"text":"Bleve is a modern text indexing library for go."}'↵$ ./bin/bayard set 4 '{"text":"Whoosh is a fast, pure Python search engine library."}'↵$ ./bin/bayard set 5 '{"text":"Solr is highly reliable, scalable and fault tolerant, providing distributed indexing, replication and load-balanced querying, automated failover and recovery, centralized configuration and more."}'↵$ ./bin/bayard set 6 '{"text":"Elasticsearch is a distributed, open source search and analytics engine for all types of data, including textual, numerical, geospatial, structured, and unstructured."}'↵$ ./bin/bayard set 7 '{"text":"Riot is Go Open Source, Distributed, Simple and efficient full text search engine."}'↵$ ./bin/bayard set 8 '{"text":"Blast is a full text search and indexing server, written in Go, built on top of Bleve."}'↵$ ./bin/bayard set 9 '{"text":"Toshi is meant to be a full-text search engine similar to Elasticsearch. Toshi strives to be to Elasticsearch what Tantivy is to Lucene."}'↵$ ./bin/bayard set 10 '{"text":"Sonic is a fast, lightweight and schema-less search backend."}'↵$ ./bin/bayard set 11 '{"text":"Bayard is a full text search and indexing server, written in Rust, built on top of Tantivy."}'↵</code></pre>↵<h3><a id="user-content-getting-document" class="anchor" aria-hidden="true" href="#getting-document"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Getting document</h3>↵<p>Getting a document is as following:</p>↵<pre lang="text"><code>$ ./bin/bayard get 1 | jq .↵</code></pre>↵<p>You can see the result in JSON format. The result of the above command is:</p>↵<div class="highlight highlight-source-json"><pre>{↵  <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: [↵    <span class="pl-s"><span class="pl-pds">"</span>11<span class="pl-pds">"</span></span>↵  ],↵  <span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span>: [↵    <span class="pl-s"><span class="pl-pds">"</span>Bayard is a full text search and indexing server, written in Rust, built on top of Tantivy.<span class="pl-pds">"</span></span>↵  ]↵}</pre></div>↵<h3><a id="user-content-searching-documents" class="anchor" aria-hidden="true" href="#searching-documents"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Searching documents</h3>↵<p>Searching documents is as like following:</p>↵<pre><code>$ ./bin/bayard search text:"search engine" | jq .↵</code></pre>↵<p>You can see the result in JSON format. The result of the above command is:</p>↵<div class="highlight highlight-source-json"><pre>[↵  {↵    <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: [↵      <span class="pl-s"><span class="pl-pds">"</span>4<span class="pl-pds">"</span></span>↵    ],↵    <span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span>: [↵      <span class="pl-s"><span class="pl-pds">"</span>Whoosh is a fast, pure Python search engine library.<span class="pl-pds">"</span></span>↵    ]↵  },↵  {↵    <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: [↵      <span class="pl-s"><span class="pl-pds">"</span>7<span class="pl-pds">"</span></span>↵    ],↵    <span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span>: [↵      <span class="pl-s"><span class="pl-pds">"</span>Riot is Go Open Source, Distributed, Simple and efficient full text search engine.<span class="pl-pds">"</span></span>↵    ]↵  },↵  {↵    <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: [↵      <span class="pl-s"><span class="pl-pds">"</span>1<span class="pl-pds">"</span></span>↵    ],↵    <span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span>: [↵      <span class="pl-s"><span class="pl-pds">"</span>Tantivy is a full-text search engine library inspired by Apache Lucene and written in Rust.<span class="pl-pds">"</span></span>↵    ]↵  },↵  {↵    <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: [↵      <span class="pl-s"><span class="pl-pds">"</span>2<span class="pl-pds">"</span></span>↵    ],↵    <span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span>: [↵      <span class="pl-s"><span class="pl-pds">"</span>Apache Lucene is a high-performance, full-featured text search engine library written entirely in Java.<span class="pl-pds">"</span></span>↵    ]↵  },↵  {↵    <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: [↵      <span class="pl-s"><span class="pl-pds">"</span>6<span class="pl-pds">"</span></span>↵    ],↵    <span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span>: [↵      <span class="pl-s"><span class="pl-pds">"</span>Elasticsearch is a distributed, open source search and analytics engine for all types of data, including textual, numerical, geospatial, structured, and unstructured.<span class="pl-pds">"</span></span>↵    ]↵  },↵  {↵    <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: [↵      <span class="pl-s"><span class="pl-pds">"</span>9<span class="pl-pds">"</span></span>↵    ],↵    <span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span>: [↵      <span class="pl-s"><span class="pl-pds">"</span>Toshi is meant to be a full-text search engine similar to Elasticsearch. Toshi strives to be to Elasticsearch what Tantivy is to Lucene.<span class="pl-pds">"</span></span>↵    ]↵  },↵  {↵    <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: [↵      <span class="pl-s"><span class="pl-pds">"</span>10<span class="pl-pds">"</span></span>↵    ],↵    <span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span>: [↵      <span class="pl-s"><span class="pl-pds">"</span>Sonic is a fast, lightweight and schema-less search backend.<span class="pl-pds">"</span></span>↵    ]↵  },↵  {↵    <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: [↵      <span class="pl-s"><span class="pl-pds">"</span>11<span class="pl-pds">"</span></span>↵    ],↵    <span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span>: [↵      <span class="pl-s"><span class="pl-pds">"</span>Bayard is a full text search and indexing server, written in Rust, built on top of Tantivy.<span class="pl-pds">"</span></span>↵    ]↵  },↵  {↵    <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: [↵      <span class="pl-s"><span class="pl-pds">"</span>8<span class="pl-pds">"</span></span>↵    ],↵    <span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span>: [↵      <span class="pl-s"><span class="pl-pds">"</span>Blast is a full text search and indexing server, written in Go, built on top of Bleve.<span class="pl-pds">"</span></span>↵    ]↵  }↵]</pre></div>↵<h3><a id="user-content-deleting-document" class="anchor" aria-hidden="true" href="#deleting-document"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Deleting document</h3>↵<pre><code>$ ./bin/bayard delete 11↵</code></pre>↵<h2><a id="user-content-starting-in-cluster-mode-3-node-cluster" class="anchor" aria-hidden="true" href="#starting-in-cluster-mode-3-node-cluster"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Starting in cluster mode (3-node cluster)</h2>↵<p>Bayard can easily bring up a cluster. Running in standalone is not fault tolerant. If you need to improve fault tolerance, start two more nodes as follows:</p>↵<pre><code>$ ./bin/bayard serve \↵    --host=0.0.0.0 \↵    --port=5001 \↵    --id=1 \↵    --peers="1=0.0.0.0:5001" \↵    --data-directory=./data/1 \↵    --schema-file=./etc/schema.json \↵    --unique-key-field-name=id↵↵$ ./bin/bayard serve \↵    --host=0.0.0.0 \↵    --port=5002 \↵    --id=2 \↵    --peers="1=0.0.0.0:5001,2=0.0.0.0:5002" \↵    --leader-id=1 \↵    --data-directory=./data/2 \↵    --schema-file=./etc/schema.json \↵    --unique-key-field-name=id↵↵$ ./bin/bayard serve \↵    --host=0.0.0.0 \↵    --port=5003 \↵    --id=3 \↵    --peers="1=0.0.0.0:5001,2=0.0.0.0:5002,3=0.0.0.0:5003" \↵    --leader-id=1 \↵    --data-directory=./data/3 \↵    --schema-file=./etc/schema.json \↵    --unique-key-field-name=id↵</code></pre>↵<p>Above example shows each Bayard node running on the same host, so each node must listen on different ports. This would not be necessary if each node ran on a different host.<br>↵Recommend 3 or more odd number of nodes in the cluster. In failure scenarios, data loss is inevitable, so avoid deploying single nodes.</p>↵<h3><a id="user-content-remove-a-node-from-a-cluster" class="anchor" aria-hidden="true" href="#remove-a-node-from-a-cluster"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Remove a node from a cluster</h3>↵<p>If one of the nodes in a cluster goes down due to a hardware failure and raft logs and metadata is lost, that node cannot join the cluster again.</p>↵<pre><code>$ ./bin/bayard leave \↵    --host=127.0.0.1 \↵    --port=5001 \↵    --id=3 \↵    --peers="1=0.0.0.0:5001,2=0.0.0.0:5002" \↵    --leader-id=1↵</code></pre>↵</article></div>
